{% extends "panel_template.html" %}


{% block title %} Detail page {% endblock %}
{% set onlist = False %}

{% block inner_content %}
    <div class="col-sm-12 col-md-3">
         <div class="panel-cron">
             <div class="panel-heading">Details</div>
             <div class="panel-body-cron bot-details">
                <img src="{{ url_for('static',filename="img/bot-logo-lander.png")}}" style="margin: auto; display: block; height: 100px; width: auto;"/>
                <h2 class="cron-green text-center">{{ bot.bot_name }} </h2>
                <p class="text-center text-muted">Account Hash: <a>9dfsdf872456Rfg</a></p>
                 <ul class="var-list" style="list-style-type: none;">
                    {% for tracked_var in bot.game_data.tracked_vars %}
                        <li id="{{ tracked_var.key }}">{{ tracked_var.key }}
                                {% if "%" in tracked_var.value  %}
                                <div class="progress key_var">
                                      <div class="progress-bar" role="progressbar" aria-valuenow="70"
                                      aria-valuemin="0" aria-valuemax="100" style="width:{{ tracked_var.value }}">
                                            {{ tracked_var.value }}
                                      </div>
                                </div>
                                {% else %}
                                    <span class="float-right key_var">
                                        {{ tracked_var.value }}
                                    </span>
                                {% endif %}
                        </li>
                    {% endfor %}
                </ul>
             </div>
         </div>
    </div>
    <div class="col-sm-12 col-md-3">
        <div class="panel-cron">
            <div class="panel-heading">Skills</div>
            <div class="panel-body-cron">

                    <div class="skill-container">
                        {% for skill in skills %}
                        <div class="skill">
                            <img src="{{ url_for('static',filename="img/skills/"+skill+".png") }}"/>
                            <span style="display: inline-block; margin-left: 6px;">1</span>
                        </div>
                        {% endfor %}
                    </div>

            </div>
        </div>
    </div>
    <div class="col-sm-12 col-md-3">
            <div class="panel-cron">
                <div class="panel-heading">Inventory</div>

                <div class="panel-body-cron" style="" id="inventory">
                    {%  for item in bot.game_data.inventory_items  %}
                        <div class="rs-item" style="">
                            <p style='position:absolute; margin: -3px -3px -3px 1px; color:yellow; text-shadow: 1px 1px #000000; font-family:"Source Sans Pro", sans-serif;'>{{ parse_item_amount(item.amount) }}</p>
                            <img title="{{ item_name(item.id) }}" src="{{ item_image(item.id) }}.png"/>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    <div class="col-sm-12 col-md-3">
        <div class="panel-cron">
            <div class="panel-heading">Notifications</div>
            <div class="panel-body-cron" style="padding: 0;">
                    <div class="shout">
                        <span class="cron-text cron-green">YOU GAINED A LEVEL!</span>
                        <p class="text-muted" style="font-size: 0.9em;">Timestamp: 1:00:00 UTC</p>
                        Your Strength level is now 71
                    </div>
                <div class="shout">
                         <span class="cron-text cron-green">YOU GAINED A LEVEL!</span>
                        <p class="text-muted" style="font-size: 0.9em;">Timestamp: 1:00:00 UTC</p>
                        Your Strength level is now 70
                    </div>

            </div>
        </div>
    </div>
{% endblock %}


{% block javascript %}
<script type="text/javascript" charset="utf-8">
    {% if webToken%}

        var socket = io.connect('http://' + document.domain + ':' + location.port);
            socket.on('connect', function() {
                socket.emit('details',
                    {
                        data: '{{ webToken }}',
                        bot_id: {{ bot_id }}
                    }
                );
            });

            socket.on('disconnect', function() {
                socket.emit('disconnect');
            });

        function updateInventory(json_data) {
            inventory = $("#inventory");
            inventory.empty();
            inventory_data = json_data["data"]["inventory_items"];
            for (var i = 0; i < inventory_data.length; i++)
            {
                id = inventory_data[i]["id"];
                amount = inventory_data[i]["amount"];
                name = "";
                $.ajax({
                    url: "{{ url_for('panel_controller.get_item_name') }}",
                    method: 'POST',
                    contentType: "application/json",
                    data: JSON.stringify(
                        {
                            "item_id" : id
                        }
                    ),
                    success: function (result) {
                        name = result;
                        console.log("RESULT NAME = " + name);
                    }
                });
                item = '<div class="rs-item" style="">' +
                    '<p style="position:absolute; margin: -3px -3px -3px 1px; color:yellow; text-shadow: 1px 1px #000000; font-family:"Source Sans Pro", sans-serif;">'+amount+'</p>' +
                    '<img title="'+name+'" src="http://cdn.rsbuddy.com/items/'+id+'.png"/> ' +
                '</div>';
                inventory.append(item);
            }

        }

        socket.on('update_details', function (data) {
                console.log("received an update_details");
                console.log(data);
                json_data = JSON.parse(data);
                for (var i = 0; i < json_data["data"]["tracked_vars"].length; i++) {
                    entry = json_data["data"]["tracked_vars"][i];
                    key = entry["key"];
                    value = entry["value"];
                    $("#"+key).find(".key_var").text(value)
                }
                updateInventory(json_data);
            });
    {% endif %}
    </script>
{% endblock %}